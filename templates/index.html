<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musteri Terk Analizi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
<div class="container mt-5">
    <h1 class="mb-4">Musteri Terk Analizi Dashboard</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card bg-secondary mb-4">
        <div class="card-header">CSV Dosyasi Yukleyin</div>
        <div class="card-body">
            <form action="/upload" method="post" enctype="multipart/form-data">
                <input type="file" name="file" accept=".csv" class="form-control mb-2">
                <button type="submit" class="btn btn-light">Yukle</button>
            </form>
            {% if filename %}
                <p class="mt-2 text-success">Yuklenen dosya: <strong>{{ filename }}</strong></p>
            {% endif %}
        </div>
    </div>

    {% if filename %}
        <div class="card bg-secondary mb-4">
            <div class="card-header">Hedef Degiskeni Secin</div>
            <div class="card-body">
                <form action="/set_target" method="post">
                    <div class="input-group">
                        <label class="input-group-text bg-dark text-light" for="target_column">Sutun:</label>
                        <select class="form-select" name="target_column" id="target_column" required>
                            {% for col in columns %}
                                <option value="{{ col }}" {% if col == selected_target %}selected{% endif %}>{{ col }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-warning">Kaydet</button>
                    </div>
                </form>
                {% if selected_target %}
                    <p class="mt-2 text-warning">Secilen hedef: <strong>{{ selected_target }}</strong></p>
                {% endif %}
            </div>
        </div>

        <div class="card bg-secondary mb-4">
            <div class="card-header">Kesifsel Veri Analizi (EDA)</div>
            <div class="card-body">
                <a href="/eda" class="btn btn-info">EDA'yi Goster</a>
            </div>
        </div>

        <div class="card bg-secondary mb-4">
            <div class="card-header">Modeli Egit ve Tahmin Yap</div>
            <div class="card-body">
                <form action="/train" method="post">
                    <button type="submit" class="btn btn-success">Modeli Egit</button>
                </form>
            </div>
        </div>
        
        {% if model_trained %}
        <div class="card bg-secondary mb-4">
            <div class="card-header">Musteri Terk Riskini Yorumla (SHAP)</div>
            <div class="card-body">
                <p>Eğitilen modelin tek bir müşterinin risk kararını nasıl verdiğini görün.</p>
                <a href="/interpret" class="btn btn-danger">Rastgele Müşteriyi Yorumla</a>
            </div>
        </div>
        {% endif %}
        {% endif %}

    {% if result %}
    <div class="card bg-secondary mb-4">
        <div class="card-header">Model Egitim Sonuclari</div>
        <div class="card-body">
            {{ result | safe }}
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>